<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <title>App2</title>
      <style>
          @media (min-width:200px) {
              /* en mode mobile */
              td.titre1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 10px;
                  width: 60px;
              }

              button.style1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 10px;
                  width: 100%;
                  height: 40px;
              }
              button.style2 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 8px;
                  width: 100%;
                  height: 20px;
              }
              td.Bp {
                  width: 40px;
              }

              td.style2 {
                  margin-left: 0px;
                  margin-right: 0px;
                  width: 20px;
              }

              button.ecran {
                  width: 20px;
                  height: 20px;
              }
              img.red {
                  margin-left: 0px;
                  margin-right: 0px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
                  width:100%;
              }
          }
          @media (max-device-width:480px) {
              /* en mode mobile */
              td.titre1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 10px;
                  width: 60px;
              }
              button.style1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 10px;
                  width: 100%;
                  height:60px;
              }
              button.style2 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 10px;
                  width:100%;
                  height: 30px;
              }
              td.Bp {
                  width: 40px;
             }
              td.style2 {
                  margin-left: 0px;
                  margin-right: 0px;
                  width: 30px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
              }
              button.ecran {
                  width: 48px;
                  height: 48px;
              }
              img.red {
                  margin-left: 0px;
                  margin-right: 0px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
                  width: 100%;
              }
          }
          @media (min-width:480px) and (orientation:portrait) {
              /* mode portait pc */
              td.titre1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 20px;
                  width: 80px;
              }
              button.style1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 18px;
                  width: 100%;
                  height: 80px;
              }
              button.style2 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 15px;
                  width: 100%;
                  height: 30px;
              }
              td.Bp {
                  width: 120px;
              }

              td.style2 {
                  margin-left: 0px;
                  margin-right: 0px;
                  width: 40px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
              }
              button.ecran {
                  width: 37px;
                  height:95px;

              }
              img.red {
                  margin-left: 0px;
                  margin-right: 0px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
                  width:100%;
              }
          }

          @media (min-width:480px) and (orientation:landscape) {
              /* mode portait pc */
              td.titre1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 20px;
                  width: 100px;
              }

              button.style1 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 20px;
                  width: 100%;
                  height: 60px;
              }
              button.style2 {
                  font-family: arial;
                  font-weight: bold;
                  color: black;
                  font-size: 20px;
                  width: 100%;
                  height: 30px;
              }
              td.Bp {
                  width: 150px;
                  
              }

              td.style2 {
                  margin-left: 0px;
                  margin-right: 0px;
                  width: 40px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
              }
              button.ecran {
                  width: 95px;
                  height: 37px;
              }
              img.red {
                  margin-left: 0px;
                  margin-right: 0px;
                  bottom: 0px;
                  top: 0px;
                  left: 0px;
                  right: 0px;
                  width: 100%;
              }
          }

            /* commun */

        .titre2 {
            font-family: arial;
            font-weight: bold;
            color: black;
            font-size: 20px;
        }
          img.title {
              zoom: 35%;
          }
          td {
              margin-left: 0px;
              margin-right: 0px;
          }
          img {
              bottom: 0px;
              top: 0px;
              left: 0px;
              right: 0px;
          }
          span.mark {
              font-family:arial;
              font-weight:bold;
              color:black;
              font-size:10px;
          }
      </style>
    <!-- RÃ©fÃ©rences WinJS -->
    <!-- <link href="//Microsoft.WinJS.2.0/css/ui-dark.css" rel="stylesheet"> --> 
    <!--<script src="//Microsoft.WinJS.2.0/js/base.js"></script>-->
    <!--<script src="//Microsoft.WinJS.2.0/js/ui.js"></script>-->
    <!-- RÃ©fÃ©rences App2 -->
    <!-- <link href="/css/default.css" rel="stylesheet">-->
    <!--<script src="/js/default.js"></script>-->
   
      
    

    <script type="text/javascript">
        // pose un timer sur la mise à jour auto  des positions (via la fonction position voir plus bas) toutes les secondes
       
        var window_handle; // variable globale du script, à ne surtout pas modifier !!!
        var codemod = 6; // valeur couranet de décrement d'adresse module 
        var numModuleControle =0; 
        var codePassage = 0; // nb de passage de refresh
        var AlarmeST = 0; // valeur de l'alarme
        var Adresse = ['10.10.1.85', '10.10.1.87'];
        var CodeGroup = [255, 254];
        var ES1 = 0; // entrée/sortie 1
        var ES2 = 0; // entrée sortie 2
        //setTimeout(function () { RendStatut2(1); }, 1000);
        var timermaj = window.setInterval("position(0)", 1000);
        // création du tableau des valeurs des modules
        // il sont dimmenssionné par défaut au max utilisé
        var ValuesModule = new Array(7);
        for (i = 0; i < 7; i++) {
            ValuesModule[i] = new Array(5);
        }
        var ValuesNano = new Array(10);
        var valuesTempo = new Array(25); 
        /* les deux premiers le n° de groupe et de module actif sur le Nano  ( de 0 à 1)
        les 5 suivants les valeurs (maxi courant, timer up, timer down, last error, last current (de 2 à 6) 
        les 7 suivants les valeurs de positons des 7 modules gérés (de 7 à 13)
        les suivants la valeurs des entrées digitales de 2 à 4 et puis de A0 à A3 (car possible de les optocoupler en digital) chaque bit est la valeur de l'entrée ( 14)
        les 8 suivants sont les valeurs des entrées analogiques A0 à A7 (A0 à A3) sont donc renvoyé deux fois , une fois en dugital , une fois en analogique ( de 15 à 22)
        les deux derniers sont les valeurs des mot de sorties Digital des 74HC495 en firstoutput(LSB)  et secondoupt (MSB).
        NB sur le firstoutput les 7 premiers bits sont ceux permettant au Nano de basculer la liaison série sur un des 7 modules (en lecture ) (de 23 à 24)
        */ 
        // ceci est la réponse à un ordre S= (statut) au nano
                            

        function RenvoiData(IdControle,tpe) {
            // renvoi le code adresse du controle
            switch (IdControle) {
                case "I01":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 240;
                    numModuleControle =0;
                    break;
                case "I02":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 241;
                    numModuleControle =1;
                    break;
                case "I03":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 242;
                    numModuleControle =2;
                    break;
                case "I04":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 243;
                    numModuleControle =3;
                    break;
                case "I05":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 244;
                    numModuleControle =4;
                    break;
                case "I06":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 245;
                    numModuleControle =5;
                    break;
                case "I07":
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 246;
                    numModuleControle =6;
                    break;
               
                default:
                    numAdresse = 0;
                    numGroupe = 0;
                    codeModule = 240;
                    numModuleControle =0;
            }// fin siwtch 1
            switch (tpe) {
                case 0:
                    //adresse
                    return numAdresse;
                    break;
                case 1:
                    // groupe
                    return numGroupe;
                    break;
                case 3:
                    return numModuleControle;
                    break;
                default:
                    // autre = codemodule
                    return codeModule;
                    break;
            }
        }
          // envoi une requette de type ordre à un module (volet roulant ou autre type volet V171 via une platine nano avec shield ethernet en serveur)
          function VoletNano1( statut1, ordre) {
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              var codeModule= RenvoiData(statut1,2); // code du module
              var statut2 = 'statut';// ID controle du document ou poser le statut
              var numGroupe = RenvoiData(statut1,1);
              var numAdresse = RenvoiData(statut1, 0);
              var numModule = RenvoiData(statut1,3);
             
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
              url = url.concat(Adresse[numAdresse], '/o=', CodeGroup[numGroupe], codeModule, ordre, numModule);
              document.getElementById(statut1).setAttribute("src",  "img/RondVide.jpg");
              document.title = "...";numAdresse
              try {
                  xhr.onreadystatechange = function () { 
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          document.getElementById(statut2).innerHTML = xhr.responseText;
                          if (xhr.responseText.substr(0, 2) == "OK") {
                              document.getElementById(statut1).setAttribute("src", "img/RondVert.jpg");
                              // si tout OK , remet en marche la tempo de raffraichissement aprsè l'envoi d'ordre 
                              window.clearInterval(timermaj);
                              timermaj = window.setInterval("position(0)", 10000);
                          } else {
                              document.getElementById(statut1).setAttribute("src", "img/RondOrange.jpg");
                          }
                          document.title = "Domotic";
                      } else { document.title = ".".concat(xhr.readystate); }
                      return xhr.readyState;
                  } ;
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }
              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ",e.description," ", e.number, " ", e.name);
                  alert(mess);
                  document.getElementById(statut1).setAttribute("src", "img/RondRouge.jpg");
              }
          }
          function StatutVolet(statut1) {
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              var codeModule = RenvoiData(statut1, 2); // code du module
              var statut2 = 'statut';// ID controle du document ou poser le statut
              var numGroupe = RenvoiData(statut1, 1);
              var numAdresse = RenvoiData(statut1, 0);
              var numModule = RenvoiData(statut1,3);

              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
              url = url.concat(Adresse[numAdresse], '/o=', CodeGroup[numGroupe], codeModule ,'?' ,numModule);
              document.getElementById(statut1).setAttribute("src", "img/RondVide.jpg");
              document.title = "..."; numAdresse
              try {
                  xhr.onreadystatechange = function () {
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          document.getElementById(statut2).innerHTML = xhr.responseText;
                          if (xhr.responseText.substr(0, 2) == "OK") {
                              document.getElementById(statut1).setAttribute("src", "img/RondVert.jpg");
                              window.clearInterval(timermaj);
                              // si tout OK , remet en marche la tempo de raffraichissement aprsè l'envoi d'ordre 
                              timermaj = window.setInterval("position(0)", 5000);
                          } else {
                              document.getElementById(statut1).setAttribute("src", "img/RondOrange.jpg");
                          }
                          document.title = "Domotic";
                      } else { document.title = ".".concat(xhr.readystate); }
                      return xhr.readyState;
                  };
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }

              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                  alert(mess);
                  document.getElementById(statut1).setAttribute("src", "img/RondRouge.jpg");
              }
          }
            // fonction pour formater un chiffre, non utilisée dans cette version
          function format(valeur, decimal, separateur) {
              // formate un chiffre avec 'decimal' chiffres après la virgule et un separateur
              var deci = Math.round(Math.pow(10, decimal) * (Math.abs(valeur) - Math.floor(Math.abs(valeur))));
              var val = Math.floor(Math.abs(valeur));
              if ((decimal == 0) || (deci == Math.pow(10, decimal))) { val = Math.floor(Math.abs(valeur)); deci = 0; }
              var val_format = val + "";
              var nb = val_format.length;
              for (var i = 1; i < 4; i++) {
                  if (val >= Math.pow(10, (3 * i))) {
                      val_format = val_format.substring(0, nb - (3 * i)) + separateur + val_format.substring(nb - (3 * i));
                  }
              }
              if (decimal > 0) {
                  var decim = "";
                  for (var j = 0; j < (decimal - deci.toString().length) ; j++) { decim += "0"; }
                  deci = decim + deci.toString();
                  val_format = val_format + "." + deci;
              }
              if (parseFloat(valeur) < 0) { val_format = "-" + val_format; }
              return val_format;
          }
        // fonction pour questionner l'arduino  nano sur la position d'un volet de façon récursive sur un codemod incrémental
          function position(numAdresse) {
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
              var xhr2 = new XMLHttpRequest();
              var statut2 = 'statut';// ID controle du document ou poser le statut
              var url = 'http://';
              codemod = codemod + 1;
              if (codemod == 7) {
                  setTimeout(function () { RendStatut2(1); }, 1000);
                  window.clearInterval(timermaj);
                  timermaj = window.setInterval("position(0)", 5000);
              } else {
                  if (codemod > 7) {
                      codemod = 0;
                  }
                  var visu = "I0";
                  visu = visu.concat(codemod + 1);
                  document.getElementById(visu).setAttribute("src", "img/RondVide.jpg");
                  // demande la position au module
                  var module = "";
                  module = module.concat(112 + codemod);
                  module = "000".substring(0, 3 - module.length).concat(module)
                  url = url.concat(Adresse[numAdresse], '/o=255', module, '0', codemod);
                  try {
                      xhr2.onreadystatechange = function () {
                          if (xhr2.readyState == 4 && (xhr2.status == 200 || xhr2.status == 0)) {
                              document.getElementById(statut2).innerHTML = xhr2.responseText;
                              if (xhr2.responseText.substr(0, 2) == "OK") {
                                  document.getElementById(visu).setAttribute("src", "img/RondJaune.jpg");
                                  // si tout OK , remet en marche la tempo de raffraichissement aprsè l'envoi d'ordre 
                                  setTimeout(function () { RendStatut(numAdresse, visu); }, 1000);
                              } else {
                                  document.getElementById(visu).setAttribute("src", "img/RondOrange.jpg");
                              }
                              document.title = "Domotic";
                          } else { document.title = ".".concat(xhr2.readystate); }
                          return xhr2.readyState;
                      };
                      xhr2.open("GET", url, true);
                      xhr2.send(null);
                  }
                  catch (e) {
                      var mess = e.name;
                      mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                      alert(mess);
                      document.getElementById(visu).setAttribute("src", "img/RondRouge.jpg");
                  }
              }
              
              //xhr2.open("GET", url, true);
              //xhr2.send(null);
              
              
              
              //document.getElementById(visu).setAttribute("src", "img/RondVert.jpg");
              //document.getElementById('statut').innerHTML = xhr.responseText;
          }

          function positionVolet(numAdresse, module) {
          }
          function RendStatut(numAdresse, visu) {
              // envoi une request type s=
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
               // renvoi la position (type = 003)
              url = url.concat(Adresse[numAdresse], '/S=');
             
              //document.getElementById(visu).setAttribute("src", "img/RondVide.jpg");
              //document.title = "...";
              try {
                  //xhr.onreadystatechange = ReponseVolet(xhr,statut1, statut2);
                  xhr.onreadystatechange = function () {
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          //document.getElementById(statut2).innerHTML = xhr.responseText;
                          window.clearInterval(timermaj);
                          timermaj = window.setInterval("position(0)", 5000);
                          if (xhr.responseText.substr(0, 6) == "{\"ST\":") {
                              document.getElementById(visu).setAttribute("src", "img/RondVert.jpg");
                              
                              var posi = xhr.responseText.substr(6, 255);
                              if (posi.indexOf("}", 1) > 0) {
                                  posi = posi.substring(0, posi.indexOf("}") );
                              }
                              valuesTempo=posi.split(",",25);
                              document.getElementById('statut').innerHTML = xhr.responseText;
                              //document.getElementById('statut2').innerHTML = " ".concat(volet, " ", voletim," ", visu ," " , url);
                              TraiteRecu();
                              
                          } else {
                              document.getElementById(visu).setAttribute("src", "img/RondOrange.jpg");
                              document.getElementById('statut').innerHTML = xhr.responseText;
                              document.getElementById('statut2').innerHTML = url;
                          }
                          //document.title = "Domotic";
                      } else { //document.title = ".".concat(xhr.readystate); 
                      }
                      
                      return xhr.readyState;
                  };
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }
              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                  alert(mess);
                  document.getElementById(visu).setAttribute("src", "img/RondRouge.jpg");
              }
          }
          function RendStatut2(numAdresse) {
              // envoi une request type s=
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              //window.clearInterval(timermaj);
              // renvoi la position (type = 003)
              url = url.concat(Adresse[numAdresse], '/S=');

              //document.getElementById(visu).setAttribute("src", "img/RondVide.jpg");
              //document.title = "...";
              try {
                  //xhr.onreadystatechange = ReponseVolet(xhr,statut1, statut2);
                  xhr.onreadystatechange = function () {
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          //document.getElementById(statut2).innerHTML = xhr.responseText;
                          //window.clearInterval(timermaj);
                          //timermaj = window.setInterval("position(0)", 10000);
                          if (xhr.responseText.substr(0, 6) == "{\"ST\":") {
                              //document.getElementById(visu).setAttribute("src", "img/RondVert.jpg");

                              var posi = xhr.responseText.substr(6, 255);
                              if (posi.indexOf("}", 1) > 0) {
                                  posi = posi.substring(0, posi.indexOf("}"));
                              }
                              valuesTempo = posi.split(",", 25);
                              document.getElementById('statut').innerHTML = xhr.responseText;
                              //document.getElementById('statut2').innerHTML = " ".concat(volet, " ", voletim," ", visu ," " , url);
                              TraiteRecu2();

                          } else {
                              //document.getElementById(visu).setAttribute("src", "img/RondOrange.jpg");
                              document.getElementById('statut').innerHTML = xhr.responseText;
                              document.getElementById('statut2').innerHTML = url;
                          }
                          //document.title = "Domotic";
                      } else { //document.title = ".".concat(xhr.readystate); 
                      }

                      return xhr.readyState;
                  };
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }
              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                  alert(mess);
                  document.getElementById(visu).setAttribute("src", "img/RondRouge.jpg");
              }
          }
          function TraiteRecu() {
              // les volets 
              for (i = 0; i < 6; i++) {
                  var volet = "V0";
                  volet = volet.concat(i + 1);
                  var voletim = "img/volet";
                  var posi = valuesTempo[7 + i];
                  posi = parseInt(posi / 25 + 0.5) * 25;
                  if (posi > 100) { posi = 100; }
                  if (posi < 0) { posi = 0; }
                  var pos = parseInt(posi);
                  voletim = voletim.concat(pos, ".jpg");
                  document.getElementById(volet).setAttribute("src", voletim);
                  //document.getElementById('statut2').innerHTML = " ".concat(volet, " ", voletim, " ", visu, " ", url);
              }
              // les entrées
              // digitales
              //document.getElementById('alarme').setAttribute("src", "img/RondVert.jpg");
              for (i = 0; i < 8; i++) {
                  if  ((valuesTempo[14] & (1<<i)) == (1<<i)) { 
                      //on
                      switch (i) {
                          case 0:
                              // pb2
                              //document.getElementById('porte').setAttribute("src", "img/RondRouge.jpg");
                              break;
                          case 1:
                              //pb3
                              //document.getElementById('alarme').setAttribute("src", "img/RondOrange.jpg");
                          case 2:
                              //pb4
                              //document.getElementById('alarme').setAttribute("src", "img/RondRouge.jpg");
                          case 3:
                              // PA0
                          case 4:
                              //PA1
                          case 5:
                              //pA2
                          case 6:
                              //PA3
                      }
                  } else {
                    // off
                      switch (i) {
                          case 0:
                              // pb2
                              //document.getElementById('porte').setAttribute("src", "img/RondVert.jpg");
                              break;
                          case 1:
                              //pb3
                          case 2:
                              //pb4
                          case 3:
                              // PA0
                          case 4:
                              //PA1
                          case 5:
                              //pA2
                          case 6:
                              //PA3
                      }
                  }
              }
              // analogiques
              for (i = 0; i < 8; i++) {
                  document.getElementById('value'.concat(i + 1)).innerHTML = "A0".concat( i , "=<br>", format(5*valuesTempo[15 + i]/1024,2)," V");
              }
              //les sorties
              ES1 = valuesTempo[24]<<1;
              if (valuesTempo[23] > 127) { // on s1
                  document.getElementById('S1').setAttribute("src", "img/RondRouge.jpg");
                  ES1 = ES1 + 1;
              } else { //off S1
                  document.getElementById('S1').setAttribute("src", "img/RondVert.jpg");
              }
              for (i = 0; i < 7; i++) {
                  if ((valuesTempo[24] & (1 << i)) == (1 << i)) { // on S i+2
                      document.getElementById('S' + (i+2)).setAttribute("src", "img/RondRouge.jpg");
                  } else {// off S i+2 
                      document.getElementById('S' + (i+2)).setAttribute("src", "img/RondVert.jpg");
                  }
              }
          }
          function TraiteRecu2() {
              // les volets 
              // Alarme
              switch (valuesTempo[0]) {
                  case "-1":
                      // indéterminé
                      document.getElementById('alarme').setAttribute("src", "img/RondJaune.jpg");
                      break;
                  case "0":
                      // off
                      document.getElementById('alarme').setAttribute("src", "img/RondVert.jpg");
                      break;
                  case "1":
                      // partiel
                      document.getElementById('alarme').setAttribute("src", "img/RondOrange.jpg");
                      break;
                  case "2":
                      // compléte
                      document.getElementById('alarme').setAttribute("src", "img/RondRouge.jpg");
                      break;
                  default:
                      document.getElementById('alarme').setAttribute("src", "img/RondVide.jpg");
                      break;
              }
              //document.getElementById('alarme').setAttribute("src", "img/RondOrange.jpg");
              // les entrées
              // digitales
              
              for (i = 0; i < 8; i++) {
                  if ((valuesTempo[14] & (1 << i)) == (1 << i)) {
                      //on
                      switch (i) {
                          case 0:
                              // pb2
                              //document.getElementById('porte').setAttribute("src", "img/RondRouge.jpg");
                              break;
                          case 1:
                              //pb3
                              //document.getElementById('alarme').setAttribute("src", "img/RondOrange.jpg");
                              break;
                          case 2:
                              //pb4
                              //document.getElementById('alarme').setAttribute("src", "img/RondRouge.jpg");
                              break;
                          case 3:
                              // PA0
                          case 4:
                              //PA1
                          case 5:
                              //pA2
                          case 6:
                              //PA3
                      }
                  } else {
                      // off
                      switch (i) {
                          case 0:
                              // pb2
                              //document.getElementById('porte').setAttribute("src", "img/RondVert.jpg");
                              break;
                          case 1:
                              //pb3
                          case 2:
                              //pb4
                          case 3:
                              // PA0
                          case 4:
                              //PA1
                          case 5:
                              //pA2
                          case 6:
                              //PA3
                      }
                  }
              }
              // analogiques
              // analogiques
             // for (i = 0; i < 8; i++) {
                  //document.getElementById('value'.concat(i + 1)).innerHTML = "A0".concat(i, "=<br>", format(5 * valuesTempo[15 + i] / 1024, 2), " V");
             // }
              if (valuesTempo[7] < 500) {
                  document.getElementById('porte').setAttribute("src", "img/RondRouge.jpg");
              } else
              {
                  document.getElementById('porte').setAttribute("src", "img/RondVert.jpg");
              }
             
          }
          function SetOn(value, numAdresse) {
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
              var valeur = "";
              var valuet = 0;
              value = 1 << (value - 1);
              value = value ^ ES1;
              valeur = valeur.concat(value);
              
              valeur = "000".substring(0, 3 - valeur.length).concat(valeur);
              // renvoi la position (type = 003)
              url = url.concat(Adresse[numAdresse], '/o=001', valeur,'p');
              try {
                 
                  xhr.onreadystatechange = function () {
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          //document.getElementById(statut2).innerHTML = xhr.responseText;
                          var visu = "I0";
                          visu = visu.concat(codemod + 1);
                          setTimeout(function () { RendStatut(numAdresse,visu); }, 1000);
                          window.clearInterval(timermaj);
                          timermaj = window.setInterval("position(0)", 5000);
                         // window.clearInterval(timermaj);
                         // timermaj = window.setInterval("position(0)", 10000);
                         

                          } else {
                           
                          }
                      
                      return xhr.readyState;
                  };
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }
              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                  alert(mess);
                 
              }
          }
          function SetAlarme(value, numAdresse) {
              var xhr = new XMLHttpRequest();
              var url = 'http://';
              // stop la tempo de raffraichissement pendant l'envoi d'ordre pour éviter du surcharger le serveur eternet avec des demandes multiples du même client
              window.clearInterval(timermaj);
              document.getElementById('alarme').setAttribute("src", "img/RondVide.jpg");
              var valeur = "";
              //valeur = valeur.concat(1 << (value - 1));
              valeur = valeur.concat(value);
              valeur = "000".substring(0, 3 - valeur.length).concat(valeur);
              // renvoi la position (type = 003)
              url = url.concat(Adresse[numAdresse], '/o=', valeur ,"255d");
              try {

                  xhr.onreadystatechange = function () {
                      if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                          //document.getElementById(statut2).innerHTML = xhr.responseText;
                          //window.clearInterval(timermaj);
                          //timermaj = window.setInterval("position(0)", 10000);
                          setTimeout(function () { RendStatut2(1); }, 1500);
                          window.clearInterval(timermaj);
                          timermaj = window.setInterval("position(0)", 5000);

                      } else {

                      }

                      return xhr.readyState;
                  };
                  xhr.open("GET", url, true);
                  xhr.send(null);
              }
              catch (e) {
                  var mess = e.name;
                  mess = mess.concat(" ", e.description, " ", e.number, " ", e.name);
                  alert(mess);

              }
          }
          function Maj() {
              // met à jour par statut 2
              window.clearInterval(timermaj);
              setTimeout(function () { RendStatut2(1); }, 1000);
              window.clearInterval(timermaj);
              timermaj = window.setInterval("position(0)", 5000);
          }
      </script>
  </head>
<body>
    <h1 style="font-family:arial;font-weight:bold;color:blue;font-size:30px;">
        <b>Domtic</b>
        <button class="Alarme" onclick="position(0);" type="button">
            .
        </button>
        
    </h1>
    <table style="width: 100%" border="1">
    <tbody>
        <tr>
            <td>
                <span style="font-family:arial;font-weight:bold;color:black;font-size:15px;">  Doors  </span>
                <img class="title" id="porte" title="Porte" alt="close" src="img/RondVide.jpg">
            </td>
            <td>
                <span style="font-family:arial;font-weight:bold;color:black;font-size:15px;">  Alarm </span>
                <img style="zoom:100%; m:20px;" id="alarme" title="Alarme" alt="not set" src="img/RondVide.jpg" onclick="Maj();">
                <button style="height:45px;" onclick="SetAlarme(3,1);" 
                        type="button">
                    Total
                </button>
                <span style="font-family:arial;font-weight:bold;color:black;font-size:15px;"> - </span>
                <button style="height:45px;" onclick="SetAlarme(2,1);"
                        type="button">
                    Partiel.
                </button>
                <span style="font-family:arial;font-weight:bold;color:black;font-size:15px;"> - </span>
                <button style="height:45px;"  onclick="SetAlarme(254,1);" type="button"> OFF </button>
            </td>
            <td>
                <span class="mark" id="value1" >  A0  </span>
            </td>
            <td>
                <span class="mark" id="value2" >  A1 </span>
            </td>
            <td>
                <span class="mark" id="value3" >  A2  </span>
            </td>
            <td>
                <span class="mark" id="value4" >  A3  </span>
            </td>
            <td>
                <span class="mark" id="value5" >  A4  </span>
            </td>
            <td>
                <span class="mark" id="value6" >  A5  </span>
            </td>
            <td>
                <span class="mark" id="value7" >  A6  </span>
            </td>
            <td>
                <span class="mark" id="value8" >  A7  </span>
            </td>
            <td>
                <img class="title" id="S1"  alt="S1" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(1,0);"
                        type="button">
                    On<br>Off
                </button>
                
            </td>
            <td>
                <img class="title" id="S2" alt="S2" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(2,0);"
                        type="button">
                    On<br>Off
                </button>
                
            </td>
            <td>
                <img class="title" id="S3" alt="S3" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(3,0);"
                        type="button">
                    On<br>Off
                </button>
                
            </td>
            <td>
                <img class="title" id="S4" alt="S4" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(4,0);"
                        type="button">
                    On<br>Off
                </button> 
            </td>
            <td>
                <img class="title" id="S5" alt="S5" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(5,0);"
                        type="button">
                    On<br>Off
                </button>
               
            </td>
            <td>
                <img class="title" id="S6" alt="S6" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(6,0);"
                        type="button">
                    On<br>Off
                </button>
            </td>
            <td>
                <img class="title" id="S7" alt="S7" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(7,0);"
                        type="button">
                    On<br>Off
                </button>
            </td>
            <td>
                <img class="title" id="S8" alt="S8" src="img/RondVide.jpg">
                <button class="mark" onclick="SetOn(8,0);"
                        type="button">
                    On<br>Off
                </button>
            </td>
        </tr>
        </tbody>
    </table>
    <table style="width: 100%" border="1">
        <tbody>
            <tr>
                <td class="titre1" align="center">
                    <!--<div style="margin-left: 40px;">-->
                    Salon Bas
                    <!--</div>-->
                </td>
                <td class="style2" align="center">
                    <img  id="I01" title="I01" alt="Ok" src="img/RondVide.jpg">
                 </td>
                <td class="titre1" align="center">
                    NC                
                </td>
                <td class="style2" align="center">
                    <img id="I02" title="I02" alt="Ok" src="img/RondVide.jpg">
                </td>
                <td class="titre1" align="center">
                    NC
                </td>
                <td class="style2" align="center">
                    <img id="I03" title="I03" alt="Ok" src="img/RondVide.jpg">
                </td>
                 <td class="titre1" align="center">
                    NC
                </td>
                <td class="style2" align="center">
                    <img id="I04" title="I04" alt="Ok" src="img/RondVide.jpg">
               </td>
            </tr>
            <tr>
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1('I01', 'U');"
                             type="button">
                        /\<br>up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I01', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I01', 'D');" type="button">
                        Down<br>\/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V01" title="V01" alt="0%" src="img/Volet0.jpg">
                </td>
                
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1('I02', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I02', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I02', 'D');" type="button">
                        Down<br>\/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V02" title="V02" alt="0%" src="img/Volet0.jpg">
                </td>
                          
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1( 'I03', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I03', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1( 'I03', 'D');" type="button">
                        Down <br>\/
                    </button>
                </td>
                <td class="style2" align="center">
                   <img class="red" id="V03" title="V03" alt="0%" src="img/Volet0.jpg">
                </td>
                
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1( 'I04', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I04', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I04', 'D');" type="button">
                        Down <br>\/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V04" title="V04" alt="0%" src="img/Volet0.jpg">
                </td>
            </tr>
            <tr>
                <td class="titre1" align="center">
                    NC
                </td>
                <td class="style2" align="center">
                    <img id="I05" title="I05" alt="Ok" src="img/RondVide.jpg">
                </td>
                <td class="titre1" align="center">
                    NC
                </td>
                <td class="style2" align="center">
                    <img id="I06" title="I06" alt="Ok" src="img/RondVide.jpg">
                </td>
                <td class="titre1" align="center">
                   NC
                </td>
                <td class="style2" align="center">
                    <img id="I07" title="I07" alt="Ok" src="img/RondVide.jpg">
                </td>
                <td class="titre1" align="center">
                    T O U S
                </td>
                <td class="style2" align="center">
                    <img id="I08" title="I08" alt="Ok" src="img/RondVide.jpg">
                </td>
            </tr>
            <tr>
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1('I05', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I05', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1( 'I05', 'D');" type="button">
                        Down<br> \/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V05" title="V05" alt="0%" src="img/Volet0.jpg">
                </td>
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1( 'I06', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I06', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I06', 'D');" type="button">
                        Down<br> \/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V06" title="V06" alt="0%" src="img/Volet0.jpg">
                </td>
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1( 'I07', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                    <button class="style1" onclick="VoletNano1('I07', 'S');"
                            type="button">
                        STOP
                    </button> <br>
                    <button class="style1" onclick="VoletNano1( 'I07', 'D');" type="button">
                        Down<br> \/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V07" title="V07" alt="0%" src="img/Volet0.jpg">
                </td>
                <td class="Bp" align="center">
                    <button class="style1" onclick="VoletNano1( 'I08', 'U');"
                            type="button">
                        /\<br>Up
                    </button> <br>
                   
                    <button class="style1" onclick="VoletNano1( 'I08', 'D');" type="button">
                        Down<br> \/
                    </button>
                </td>
                <td class="style2" align="center">
                    <img class="red" id="V08" title="V08" alt="0%" src="img/Volet0.jpg">
                </td>
            </tr>
        </tbody>
    </table>
    <table style="width: 100%" border="1">
        <tbody>
            <tr>
                <!--/* statut bar */-->
                <td id="statut" width="100">
                    Statut ?
                </td>
                <td id="statut2">
                    Info ?
                </td>
                <td id="statut3" width="100">
                    nc
                </td>
            </tr>
        </tbody>
    </table>
    <table style="width: 100%" border="0">
        <tbody>
            <tr>
                <!--/* info */-->
                <td id="info1" width="100">
                    Statut ?
                </td>
                <td id="info2">
                    Info ?
                </td>
                <td id="info3" width="100">
                    nc
                </td>
                <td id="info4" width="100">
                    nc
                </td>
            </tr>
        </tbody>
    </table>

</body>
</html>
